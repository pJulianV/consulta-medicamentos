<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Medicamentos</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>CRUD Medicamentos</h1>
    
    <h2>Crear Medicamento</h2>
    <form id="createForm">
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="number" id="valor" placeholder="Valor" required>
        <input type="text" id="stock" placeholder="Stock" required>
        <input type="text" id="imagen" placeholder="Imagen URL" required>
        <button type="submit">Crear Medicamento</button>
    </form>

    <h2>Medicamentos</h2>
    <div id="medicamentosList"></div>

    <script>
        // FunciÃ³n para cargar medicamentos
        function loadMedicamentos() {
            $.get('/api/medicamentos', function(medicamentos) {
                $('#medicamentosList').empty();
                medicamentos.forEach(medicamento => {
                    $('#medicamentosList').append(`
                        <div>
                            <h3>${medicamento.nombre}</h3>
                            <p>Valor: ${medicamento.valor}</p>
                            <p>Stock: ${medicamento.stock}</p>
                            <img src="${medicamento.imagen}" alt="${medicamento.nombre}" width="100">
                            <button onclick="editMedicamento('${medicamento._id}')">Editar</button>
                            <button onclick="deleteMedicamento('${medicamento._id}')">Eliminar</button>
                        </div>
                    `);
                });
            });
        }

        // Crear medicamento
        $('#createForm').on('submit', function(e) {
            e.preventDefault();
            const nuevoMedicamento = {
                nombre: $('#nombre').val(),
                valor: $('#valor').val(),
                stock: $('#stock').val(),
                imagen: $('#imagen').val(),
            };

            $.post('/api/medicamentos', nuevoMedicamento, function() {
                loadMedicamentos();
                $('#createForm')[0].reset(); // Limpiar el formulario
            });
        });

        // Editar medicamento
        function editMedicamento(id) {
            $.get(`/api/medicamentos/${id}`, function(medicamento) {
                $('#nombre').val(medicamento.nombre);
                $('#valor').val(medicamento.valor);
                $('#stock').val(medicamento.stock);
                $('#imagen').val(medicamento.imagen);
                
                // Cambiar el evento del formulario para actualizar en vez de crear
                $('#createForm').off('submit').on('submit', function(e) {
                    e.preventDefault();
                    const updatedMedicamento = {
                        id: id, // Agregar el ID del medicamento
                        nombre: $('#nombre').val(),
                        valor: $('#valor').val(),
                        stock: $('#stock').val(),
                        imagen: $('#imagen').val(),
                    };

                    $.ajax({
                        url: `/api/medicamentos`,
                        type: 'PUT',
                        data: updatedMedicamento,
                        success: function() {
                            loadMedicamentos();
                            $('#createForm')[0].reset(); // Limpiar el formulario
                            // Restaurar el evento original
                            $('#createForm').off('submit').on('submit', function(e) {
                                e.preventDefault();
                                const nuevoMedicamento = {
                                    nombre: $('#nombre').val(),
                                    valor: $('#valor').val(),
                                    stock: $('#stock').val(),
                                    imagen: $('#imagen').val(),
                                };
                                $.post('/api/medicamentos', nuevoMedicamento, function() {
                                    loadMedicamentos();
                                    $('#createForm')[0].reset();
                                });
                            });
                        }
                    });
                });
            });
        }

        // Eliminar medicamento
        function deleteMedicamento(id) {
            $.ajax({
                url: `/api/medicamentos`,
                type: 'DELETE',
                data: { id: id },
                success: function() {
                    loadMedicamentos();
                }
            });
        }

        // Cargar medicamentos al inicio
        $(document).ready(function() {
            loadMedicamentos();
        });
    </script>
</body>
</html>